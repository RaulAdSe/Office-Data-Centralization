<svg viewBox="0 0 1600 1100" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#c62828"/>
    </marker>
    <marker id="arrowhead-purple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#7b1fa2"/>
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.25"/>
    </filter>
  </defs>
  
  <!-- Title -->
  <text x="800" y="30" font-family="Arial" font-size="28" font-weight="bold" fill="#333" text-anchor="middle">COMPLETE DATABASE SCHEMA</text>
  <text x="800" y="55" font-family="Arial" font-size="16" fill="#666" text-anchor="middle">Parametric Element Description System - 10 Tables</text>
  
  <!-- Section backgrounds -->
  <rect x="20" y="80" width="760" height="380" rx="15" fill="#e3f2fd" stroke="#1565c0" stroke-width="3" opacity="0.3"/>
  <rect x="800" y="80" width="780" height="380" rx="15" fill="#fff3e0" stroke="#e65100" stroke-width="3" opacity="0.3"/>
  <rect x="20" y="480" width="760" height="280" rx="15" fill="#e8f5e9" stroke="#2e7d32" stroke-width="3" opacity="0.3"/>
  <rect x="800" y="480" width="780" height="280" rx="15" fill="#fce4ec" stroke="#c2185b" stroke-width="3" opacity="0.3"/>
  <rect x="20" y="780" width="1560" height="280" rx="15" fill="#f3e5f5" stroke="#6a1b9a" stroke-width="3" opacity="0.3"/>
  
  <!-- Section labels -->
  <text x="40" y="110" font-family="Arial" font-size="18" font-weight="bold" fill="#0d47a1">üìê ELEMENT DEFINITIONS</text>
  <text x="820" y="110" font-family="Arial" font-size="18" font-weight="bold" fill="#e65100">üìù VERSIONING & WORKFLOW</text>
  <text x="40" y="510" font-family="Arial" font-size="18" font-weight="bold" fill="#1b5e20">üèóÔ∏è PROJECTS</text>
  <text x="820" y="510" font-family="Arial" font-size="18" font-weight="bold" fill="#880e4f">üì¶ PROJECT INSTANCES</text>
  <text x="40" y="810" font-family="Arial" font-size="18" font-weight="bold" fill="#4a148c">‚öôÔ∏è RENDERING & OUTPUT</text>
  
  <!-- TABLE 1: elements -->
  <g filter="url(#shadow)">
    <rect x="50" y="130" width="320" height="150" rx="8" fill="white" stroke="#1976d2" stroke-width="2"/>
    <rect x="50" y="130" width="320" height="40" rx="8" fill="#1976d2"/>
    <text x="210" y="157" font-family="Arial" font-size="16" font-weight="bold" fill="white" text-anchor="middle">elements</text>
    <text x="65" y="190" font-family="monospace" font-size="12" fill="#333">element_id (PK)</text>
    <text x="65" y="208" font-family="monospace" font-size="12" fill="#333">element_code (UK)</text>
    <text x="65" y="226" font-family="monospace" font-size="12" fill="#333">element_name</text>
    <text x="65" y="244" font-family="monospace" font-size="12" fill="#666">created_at, created_by</text>
    <text x="210" y="268" font-family="Arial" font-size="11" fill="#1565c0" font-style="italic" text-anchor="middle">WALL, BEAM, COLUMN</text>
  </g>
  
  <!-- TABLE 2: element_variables -->
  <g filter="url(#shadow)">
    <rect x="430" y="130" width="320" height="170" rx="8" fill="white" stroke="#1976d2" stroke-width="2"/>
    <rect x="430" y="130" width="320" height="40" rx="8" fill="#1976d2"/>
    <text x="590" y="157" font-family="Arial" font-size="16" font-weight="bold" fill="white" text-anchor="middle">element_variables</text>
    <text x="445" y="190" font-family="monospace" font-size="12" fill="#333">variable_id (PK)</text>
    <text x="445" y="208" font-family="monospace" font-size="12" fill="#c62828" font-weight="bold">element_id (FK)</text>
    <text x="445" y="226" font-family="monospace" font-size="12" fill="#333">variable_name</text>
    <text x="445" y="244" font-family="monospace" font-size="12" fill="#333">variable_type</text>
    <text x="445" y="262" font-family="monospace" font-size="12" fill="#f57f17" font-weight="bold">unit</text>
    <text x="445" y="280" font-family="monospace" font-size="12" fill="#666">default_value, is_required</text>
    <text x="590" y="293" font-family="Arial" font-size="10" fill="#666" font-style="italic" text-anchor="middle">display_order</text>
  </g>
  
  <!-- TABLE 3: description_versions -->
  <g filter="url(#shadow)">
    <rect x="830" y="130" width="360" height="170" rx="8" fill="white" stroke="#f9a825" stroke-width="2"/>
    <rect x="830" y="130" width="360" height="40" rx="8" fill="#f9a825"/>
    <text x="1010" y="157" font-family="Arial" font-size="16" font-weight="bold" fill="white" text-anchor="middle">description_versions</text>
    <text x="845" y="190" font-family="monospace" font-size="12" fill="#333">version_id (PK)</text>
    <text x="845" y="208" font-family="monospace" font-size="12" fill="#c62828" font-weight="bold">element_id (FK)</text>
    <text x="845" y="226" font-family="monospace" font-size="12" fill="#333">description_template</text>
    <text x="845" y="244" font-family="monospace" font-size="12" fill="#333">state (S0/S1/S2/S3/D)</text>
    <text x="845" y="262" font-family="monospace" font-size="12" fill="#333">is_active, version_number</text>
    <text x="845" y="280" font-family="monospace" font-size="12" fill="#666">created_at, created_by</text>
    <text x="1010" y="293" font-family="Arial" font-size="10" fill="#e65100" font-style="italic" text-anchor="middle">"Muro de {material}..."</text>
  </g>
  
  <!-- TABLE 4: template_variable_mappings (NEW) -->
  <g filter="url(#shadow)">
    <rect x="1220" y="130" width="340" height="170" rx="8" fill="white" stroke="#7b1fa2" stroke-width="3"/>
    <rect x="1220" y="130" width="340" height="40" rx="8" fill="#7b1fa2"/>
    <text x="1390" y="157" font-family="Arial" font-size="15" font-weight="bold" fill="white" text-anchor="middle">template_variable_mappings ‚≠ê</text>
    <text x="1235" y="190" font-family="monospace" font-size="12" fill="#333">mapping_id (PK)</text>
    <text x="1235" y="208" font-family="monospace" font-size="12" fill="#c62828" font-weight="bold">version_id (FK)</text>
    <text x="1235" y="226" font-family="monospace" font-size="12" fill="#c62828" font-weight="bold">variable_id (FK)</text>
    <text x="1235" y="244" font-family="monospace" font-size="12" fill="#333">placeholder</text>
    <text x="1235" y="262" font-family="monospace" font-size="12" fill="#333">position</text>
    <text x="1235" y="280" font-family="monospace" font-size="12" fill="#666">created_at</text>
    <text x="1390" y="293" font-family="Arial" font-size="10" fill="#7b1fa2" font-style="italic" text-anchor="middle">Links {placeholder} ‚Üí variable</text>
  </g>
  
  <!-- TABLE 5: approvals -->
  <g filter="url(#shadow)">
    <rect x="830" y="330" width="360" height="110" rx="8" fill="white" stroke="#f9a825" stroke-width="2"/>
    <rect x="830" y="330" width="360" height="40" rx="8" fill="#f9a825"/>
    <text x="1010" y="357" font-family="Arial" font-size="16" font-weight="bold" fill="white" text-anchor="middle">approvals</text>
    <text x="845" y="390" font-family="monospace" font-size="12" fill="#333">approval_id (PK)</text>
    <text x="845" y="408" font-family="monospace" font-size="12" fill="#c62828" font-weight="bold">version_id (FK)</text>
    <text x="845" y="426" font-family="monospace" font-size="12" fill="#333">from_state, to_state</text>
    <text x="1010" y="433" font-family="Arial" font-size="10" fill="#666" font-style="italic" text-anchor="middle">approved_by, comments</text>
  </g>
  
  <!-- TABLE 6: projects -->
  <g filter="url(#shadow)">
    <rect x="50" y="540" width="320" height="150" rx="8" fill="white" stroke="#388e3c" stroke-width="2"/>
    <rect x="50" y="540" width="320" height="40" rx="8" fill="#388e3c"/>
    <text x="210" y="567" font-family="Arial" font-size="16" font-weight="bold" fill="white" text-anchor="middle">projects</text>
    <text x="65" y="600" font-family="monospace" font-size="12" fill="#333">project_id (PK)</text>
    <text x="65" y="618" font-family="monospace" font-size="12" fill="#333">project_code (UK)</text>
    <text x="65" y="636" font-family="monospace" font-size="12" fill="#333">project_name</text>
    <text x="65" y="654" font-family="monospace" font-size="12" fill="#333">status, start_date</text>
    <text x="65" y="672" font-family="monospace" font-size="12" fill="#666">location, created_at</text>
  </g>
  
  <!-- TABLE 7: project_elements -->
  <g filter="url(#shadow)">
    <rect x="830" y="540" width="360" height="170" rx="8" fill="white" stroke="#c2185b" stroke-width="2"/>
    <rect x="830" y="540" width="360" height="40" rx="8" fill="#c2185b"/>
    <text x="1010" y="567" font-family="Arial" font-size="16" font-weight="bold" fill="white" text-anchor="middle">project_elements</text>
    <text x="845" y="600" font-family="monospace" font-size="12" fill="#333">project_element_id (PK)</text>
    <text x="845" y="618" font-family="monospace" font-size="12" fill="#c62828" font-weight="bold">project_id (FK)</text>
    <text x="845" y="636" font-family="monospace" font-size="12" fill="#c62828" font-weight="bold">element_id (FK)</text>
    <text x="845" y="654" font-family="monospace" font-size="12" fill="#7b1fa2" font-weight="bold">description_version_id (FK) üîí</text>
    <text x="845" y="672" font-family="monospace" font-size="12" fill="#333">instance_code, instance_name</text>
    <text x="845" y="690" font-family="monospace" font-size="12" fill="#666">location, created_at</text>
    <text x="1010" y="703" font-family="Arial" font-size="10" fill="#c2185b" font-style="italic" text-anchor="middle">WALL-001, BEAM-045...</text>
  </g>
  
  <!-- TABLE 8: project_element_values -->
  <g filter="url(#shadow)">
    <rect x="1220" y="540" width="340" height="150" rx="8" fill="white" stroke="#c2185b" stroke-width="2"/>
    <rect x="1220" y="540" width="340" height="40" rx="8" fill="#c2185b"/>
    <text x="1390" y="567" font-family="Arial" font-size="16" font-weight="bold" fill="white" text-anchor="middle">project_element_values</text>
    <text x="1235" y="600" font-family="monospace" font-size="12" fill="#333">value_id (PK)</text>
    <text x="1235" y="618" font-family="monospace" font-size="12" fill="#c62828" font-weight="bold">project_element_id (FK)</text>
    <text x="1235" y="636" font-family="monospace" font-size="12" fill="#c62828" font-weight="bold">variable_id (FK)</text>
    <text x="1235" y="654" font-family="monospace" font-size="12" fill="#2e7d32" font-weight="bold">value</text>
    <text x="1235" y="672" font-family="monospace" font-size="12" fill="#666">updated_at, updated_by</text>
  </g>
  
  <!-- TABLE 9: rendered_descriptions -->
  <g filter="url(#shadow)">
    <rect x="50" y="840" width="380" height="150" rx="8" fill="white" stroke="#6a1b9a" stroke-width="2"/>
    <rect x="50" y="840" width="380" height="40" rx="8" fill="#6a1b9a"/>
    <text x="240" y="867" font-family="Arial" font-size="16" font-weight="bold" fill="white" text-anchor="middle">rendered_descriptions</text>
    <text x="65" y="900" font-family="monospace" font-size="12" fill="#333">render_id (PK)</text>
    <text x="65" y="918" font-family="monospace" font-size="12" fill="#c62828" font-weight="bold">project_element_id (FK, UK)</text>
    <text x="65" y="936" font-family="monospace" font-size="12" fill="#2e7d32" font-weight="bold">rendered_text</text>
    <text x="65" y="954" font-family="monospace" font-size="12" fill="#333">is_stale, rendered_at</text>
    <text x="240" y="980" font-family="Arial" font-size="10" fill="#6a1b9a" font-style="italic" text-anchor="middle">"Muro de hormig√≥n de 300mm√ó2800mm"</text>
  </g>
  
  <!-- TABLE 10: Rendering Process (conceptual) -->
  <g>
    <rect x="500" y="840" width="1060" height="200" rx="8" fill="#f3e5f5" stroke="#6a1b9a" stroke-width="2"/>
    <text x="1030" y="870" font-family="Arial" font-size="16" font-weight="bold" fill="#6a1b9a" text-anchor="middle">RENDERING LOGIC (Application Layer)</text>
    
    <text x="520" y="900" font-family="Arial" font-size="13" fill="#333">1. Get template from description_versions</text>
    <text x="520" y="920" font-family="Arial" font-size="13" fill="#333">2. Get mappings from template_variable_mappings (ordered by position)</text>
    <text x="520" y="940" font-family="Arial" font-size="13" fill="#333">3. For each mapping:</text>
    <text x="540" y="960" font-family="Arial" font-size="12" fill="#666">a. Get variable unit from element_variables</text>
    <text x="540" y="978" font-family="Arial" font-size="12" fill="#666">b. Get value from project_element_values</text>
    <text x="540" y="996" font-family="Arial" font-size="12" fill="#666">c. Combine: value + unit (if exists)</text>
    <text x="540" y="1014" font-family="Arial" font-size="12" fill="#666">d. Replace {placeholder} in template</text>
    <text x="520" y="1032" font-family="Arial" font-size="13" fill="#333">4. Store result in rendered_descriptions</text>
  </g>
  
  <!-- RELATIONSHIPS -->
  
  <!-- elements -> element_variables -->
  <line x1="370" y1="205" x2="430" y2="205" stroke="#c62828" stroke-width="2.5" marker-end="url(#arrowhead-red)"/>
  <text x="390" y="200" font-family="Arial" font-size="10" fill="#c62828" font-weight="bold">1:N</text>
  
  <!-- elements -> description_versions -->
  <path d="M 210 280 L 210 310 L 1010 310 L 1010 300" fill="none" stroke="#c62828" stroke-width="2.5" marker-end="url(#arrowhead-red)"/>
  <text x="220" y="305" font-family="Arial" font-size="10" fill="#c62828" font-weight="bold">1:N</text>
  
  <!-- description_versions -> template_variable_mappings -->
  <line x1="1190" y1="215" x2="1220" y2="215" stroke="#7b1fa2" stroke-width="2.5" marker-end="url(#arrowhead-purple)"/>
  <text x="1195" y="210" font-family="Arial" font-size="10" fill="#7b1fa2" font-weight="bold">1:N</text>
  
  <!-- element_variables -> template_variable_mappings -->
  <path d="M 590 300 L 590 320 L 1390 320 L 1390 300" fill="none" stroke="#7b1fa2" stroke-width="2.5" marker-end="url(#arrowhead-purple)"/>
  <text x="600" y="315" font-family="Arial" font-size="10" fill="#7b1fa2" font-weight="bold">1:N</text>
  
  <!-- description_versions -> approvals -->
  <line x1="1010" y1="300" x2="1010" y2="330" stroke="#c62828" stroke-width="2.5" marker-end="url(#arrowhead-red)"/>
  <text x="1020" y="320" font-family="Arial" font-size="10" fill="#c62828" font-weight="bold">1:N</text>
  
  <!-- projects -> project_elements -->
  <path d="M 370 615 L 750 615 L 750 625 L 830 625" fill="none" stroke="#c62828" stroke-width="2.5" marker-end="url(#arrowhead-red)"/>
  <text x="380" y="610" font-family="Arial" font-size="10" fill="#c62828" font-weight="bold">1:N</text>
  
  <!-- elements -> project_elements -->
  <path d="M 210 280 L 210 470 L 800 470 L 800 625 L 830 625" fill="none" stroke="#c62828" stroke-width="2.5" marker-end="url(#arrowhead-red)"/>
  <text x="220" y="465" font-family="Arial" font-size="10" fill="#c62828" font-weight="bold">1:N</text>
  
  <!-- description_versions -> project_elements (version lock) -->
  <path d="M 1010 300 L 1010 470 L 1550 470 L 1550 625 L 1190 625" fill="none" stroke="#7b1fa2" stroke-width="3" stroke-dasharray="8,4" marker-end="url(#arrowhead-purple)"/>
  <text x="1500" y="550" font-family="Arial" font-size="11" fill="#7b1fa2" font-weight="bold" transform="rotate(-90, 1500, 550)">VERSION LOCK üîí</text>
  
  <!-- project_elements -> project_element_values -->
  <line x1="1190" y1="625" x2="1220" y2="625" stroke="#c62828" stroke-width="2.5" marker-end="url(#arrowhead-red)"/>
  <text x="1195" y="620" font-family="Arial" font-size="10" fill="#c62828" font-weight="bold">1:N</text>
  
  <!-- element_variables -> project_element_values -->
  <path d="M 590 300 L 590 760 L 1390 760 L 1390 690" fill="none" stroke="#c62828" stroke-width="2.5" stroke-dasharray="5,3" marker-end="url(#arrowhead-red)"/>
  <text x="600" y="755" font-family="Arial" font-size="10" fill="#c62828" font-weight="bold">1:N</text>
  
  <!-- project_elements -> rendered_descriptions -->
  <path d="M 1010 710 L 1010 800 L 240 800 L 240 840" fill="none" stroke="#c62828" stroke-width="2.5" marker-end="url(#arrowhead-red)"/>
  <text x="1020" y="755" font-family="Arial" font-size="10" fill="#c62828" font-weight="bold">1:1</text>
  
  <!-- Legend -->
  <g>
    <rect x="20" y="1030" width="220" height="50" rx="5" fill="white" stroke="#666" stroke-width="1"/>
    <text x="30" y="1050" font-family="Arial" font-size="12" fill="#333" font-weight="bold">Legend:</text>
    <line x1="30" y1="1060" x2="80" y2="1060" stroke="#c62828" stroke-width="2.5"/>
    <text x="85" y="1065" font-family="Arial" font-size="11" fill="#333">Foreign Key</text>
    <line x1="130" y1="1060" x2="180" y2="1060" stroke="#7b1fa2" stroke-width="3" stroke-dasharray="8,4"/>
    <text x="185" y="1065" font-family="Arial" font-size="11" fill="#333">Version Lock</text>
  </g>
  
  <!-- Table count -->
  <g>
    <circle cx="1500" cy="1055" r="35" fill="#4caf50" stroke="#2e7d32" stroke-width="3"/>
    <text x="1500" y="1067" font-family="Arial" font-size="28" fill="white" text-anchor="middle" font-weight="bold">10</text>
  </g>
  <text x="1545" y="1055" font-family="Arial" font-size="14" fill="#333">Total Tables</text>
</svg>
