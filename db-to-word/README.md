# Parametric Project Description System

This project implements a system for managing parametric architectural descriptions. It stores element templates and variables in a SQLite database, renders final text descriptions based on project-specific values, and exports the data to Excel for documentation integration.

## Project Structure

### Python Scripts

* **`gestor_db.py`**
    * **Purpose:** Database initialization and data population.
    * **Functionality:**
        * Deletes existing database files (`office_data.db`) to ensure a clean state[cite: 10].
        * [cite_start]Executes `schema.sql` to create the necessary tables, indices, and triggers[cite: 15].
        * [cite_start]Defines the element catalog (e.g., "Muro Cortina") and variables (e.g., "tipo_vidrio", "transmitancia")[cite: 20, 24].
        * Creates a sample project ("PROY-2025") and assigns specific values to instances.

* **`renderizar_y_exportar.py`**
    * **Purpose:** Logic engine and export utility.
    * **Functionality:**
        * **Rendering (`renderizar_textos`):** Identifies "stale" descriptions (flagged by database triggers) and updates them by replacing template placeholders (e.g., `{vidrio_ph}`) with actual values derived from `project_element_values`.
        * **Export (`exportar_excel_friendly`):** Generates a UX-optimized Excel report designed for Mail Merge.
            * Creates an **`INDEX_ELEMENTS`** sheet for quick user reference.
            * Creates a **`MAIL_MERGE_DATA`** sheet using **Smart Hierarchical Naming** for columns (e.g., `MC01_FACH_SUR_DESC`). This ensures variables are logically grouped by element type in Word's dropdown menu, rather than sorted alphabetically by generic names.
### Database & SQL

* **`schema.sql`**
    * [cite_start]**Purpose:** Defines the data model[cite: 1].
    * **Key Components:**
        * [cite_start]**Core Tables:** `elements`, `element_variables`, `description_versions`, `projects`[cite: 1, 9, 11].
        * **Mapping:** `template_variable_mappings` links specific variables to text placeholders within templates.
        * [cite_start]**Automation:** SQL Triggers (`trg_mark_stale_on_value_change`, `trg_mark_stale_on_value_update`) automatically flag descriptions as stale (`is_stale = 1`) whenever project values are inserted or updated[cite: 22, 28].
        * **Views:** Includes views like `v_project_elements_rendered` to simplify data retrieval for export[cite: 24].

* **`office_data.db`**
    * [cite_start]The binary SQLite database generated by running `gestor_db.py`[cite: 4].

## Usage

### 1. Initialize the Database
Run the manager script to create the database file and populate it with the schema and initial project data.

```bash
python gestor_db.py
```
Action: Creates office_data.db and inserts sample data for the "Torre Ejecutiva Norte" project.

### 2. Render and Export
Run the export script to process the text descriptions and generate the Excel report.

```bash
python renderizar_y_exportar.py
```
Action: Resolves any pending text templates and generates the PROY-2025_informe.xlsx file containing the project data.

## Output Format
The generated Excel file (PROY-2025_informe.xlsx) contains three specific sheets designed for different documentation workflows:

| Sheet Name | Description |
| :--- | :--- |
| **Datos Completos** | [cite_start]Raw tabular data of all project elements and their properties derived from the `v_project_elements_rendered` view. |
| **Referencias** | Vertical Key-Value pairs (e.g., `FACH-SUR.descripcion` -> Text). [cite_start]Ideal for OLE Linking or specific cell referencing. |
| **MailMerge** | Transposed horizontal data. [cite_start]Ideal for Word "Mailings" (Correspondence) tab integration. |

## Data Model Overview
The system relies on a relational model where:
1. Elements have Variables (properties like thickness, thermal transmittance).
2. Description Versions contain text templates with specific {placeholders}.
3. Mappings define exactly which Variable fills which Placeholder.
4. Project Elements are instances of Elements with specific Values assigned to them.
